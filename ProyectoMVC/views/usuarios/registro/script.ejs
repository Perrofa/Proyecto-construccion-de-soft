<script>
    let flag = false;
    let flag2 = false;

    document.getElementById("ver-registro").addEventListener("click", function() {
        event.preventDefault();
        if(flag){
            document.getElementById("wrapper").innerHTML = "";
            this.textContent = "Mostrar usuarios";
            this.id = "ver-registro";
        } else {
            new gridjs.Grid({
            columns: ["ID", "Nombre", "Contraseña", "Correo", "Priv"],
            pagination: true,
            search: true,
            sort: true,
            server: {
                url: "/usuarios/usuarios",
                then: data => data.usuarios.map( usuario => [usuario.UserID, usuario.NomUsuario, usuario.ContraUsuario, usuario.MailUsuario, usuario.PrivUsuario])
            }
            }).render(document.getElementById("wrapper"));

            this.textContent = "Ocultar usuarios";
            this.id = "ocultar-registro";
        }
        flag = !flag;
    });

    // Prevent form submission on GridJS interaction
    document.getElementById("registro-form").addEventListener("submit", function(event) {
        if (event.submitter && event.submitter.id !== "ver-registro") {
            alert("Usuario registrado exitosamente");
        }
    });

    document.getElementById("wrapper").addEventListener("click", function(event) {
        const registroForm = document.getElementById("registro-form");
        if (registroForm.contains(event.target)) {
            event.preventDefault();
        }
    });

    document.getElementById("eliminar-usuario").addEventListener("click", function(event) {
        if(flag2){
            document.getElementById("eliminar-form").innerHTML = "";
            this.textContent = "Eliminar usuario";
            this.id = "eliminar-usuario";
        } else {
            document.getElementById("eliminar-form").innerHTML = `
                <form action="/usuarios/registro" method="POST" id="registro-form">
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre de usuario</label>
                        <input type="text" class="form-control" id="nombre" placeholder="Nombre del usuario" name="nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="pass" class="form-label">Contraseña</label>
                        <input type="text" class="form-control" id="pass" placeholder="Contraseña del usuario" name="pass" required>
                    </div>
                    <div class="mb-3">
                        <label for="mail" class="form-label">Correo</label>
                        <input type="text" class="form-control" id="mail" placeholder="Correo del usuario" name="mail" required>
                    </div>
                    <div class="mb-3">
                        <label for="priv" class="form-label">Privilegio</label>
                        <input type="number" min="1" max="3" class="form-control" id="priv" placeholder="1-Admin   2-Desarrollador   3-Colaborador" name="priv" required>
                    </div>
                    <input class="btn btn-primary mb-3" type="submit" value="Registrar">
                </form>
            `;

            this.textContent = "Cerrar eliminar usuario";
            this.id = "ocultar-eliminar-usuario";
        }
        flag2 = !flag2;
    });
</script>